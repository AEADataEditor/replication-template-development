#  Preparing repositories

#  This automates various things in the repository
#  

clone:
  depth: 1       # shallow clone

pipelines:
  custom:
    download-icpsr: #name of this pipeline
    # Also needs configured: ICPSR_EMAIL and ICPSR_PASS
      - variables:          #list variable names under here
          - name: openICPSRID      
      - step:
          name: Download
          image: python:3.8
          caches:
            - pip
          script:
            - if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
            - if [ -f tools/openicpsr-private.py ]; then python3 tools/openicpsr-private.py $openICPSRID; fi
            - ls
            - git status
            - git push
 default:
    - parallel:
         - step:
             name: Check R files
             image: rocker/r-base
             script: 
                - R CMD BATCH tools/check_rds_files.R
         - step:
             name: Check Stata files for PII
             image: dataeditors/stata17:2022-10-11
             
 